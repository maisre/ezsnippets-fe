<div *ngIf="page" class="page-edit-container">
  <h2>Edit Page: {{ page.name || page.name || page.id }}</h2>

  <div class="page-info">
    <div *ngIf="page.name"><strong>Name:</strong> {{ page.name }}</div>
    <div *ngIf="page.siteName"><strong>Site Name:</strong> {{ page.siteName }}</div>
    <div *ngIf="page.description"><strong>Description:</strong> {{ page.description }}</div>
    <div><strong>AI Customized:</strong> {{ isAiCustomized() ? 'Yes' : 'No' }}</div>
    <div *ngIf="page.projectId"><strong>Project ID:</strong> {{ page.projectId }}</div>
    <button
      class="customize-button"
      [disabled]="customizing || isAiCustomized()"
      (click)="customize()"
    >
      {{ customizing ? 'Customizing...' : isAiCustomized() ? 'AI Customized' : 'Customize with AI' }}
    </button>
  </div>

  <div class="drag-drop-container">
    <!-- Left side: Page Snippets -->
    <div class="snippet-list-container">
      <h3>Page Snippets</h3>
      <div
        cdkDropList
        id="page-snippets"
        [cdkDropListData]="pageSnippets"
        [cdkDropListConnectedTo]="['available-snippets']"
        (cdkDropListDropped)="drop($event)"
        class="snippet-list"
      >
        <div
          *ngFor="let snippet of pageSnippets; trackBy: trackBySnippetId"
          cdkDrag
          [cdkDragStartDelay]="0"
          [cdkDragBoundary]="'.page-edit-container'"
          class="snippet-item"
        >
          <div class="snippet-content">
            <img
              [src]="viewUrl + '/public/images/screenshots/' + snippet.id + '.png'"
              alt="Snippet screenshot"
              class="snippet-screenshot"
            />
            <span class="drag-handle">⋮⋮</span>
          </div>
        </div>
        <div *ngIf="pageSnippets.length === 0" class="empty-state">
          No snippets assigned to this page
        </div>
      </div>
    </div>

    <!-- Right side: Available Snippets -->
    <div class="snippet-list-container available-snippets-container">
      <h3>Available Snippets</h3>
      <div class="snippet-filters" *ngIf="filters.types.length || filters.tags.length">
        <div class="filter-group" *ngIf="filters.types.length">
          <label>Type:</label>
          <div class="filter-chips">
            <button
              *ngFor="let type of filters.types"
              class="filter-chip"
              [class.active]="activeTypeFilter === type"
              (click)="setTypeFilter(type)"
            >{{ type }}</button>
          </div>
        </div>
        <div class="filter-group" *ngIf="filters.tags.length">
          <label>Tags:</label>
          <div class="filter-chips">
            <button
              *ngFor="let tag of filters.tags"
              class="filter-chip"
              [class.active]="activeTagFilter === tag"
              (click)="setTagFilter(tag)"
            >{{ tag }}</button>
          </div>
        </div>
        <button
          *ngIf="activeTypeFilter || activeTagFilter"
          class="clear-filters"
          (click)="clearFilters()"
        >Clear filters</button>
      </div>
      <div
        cdkDropList
        id="available-snippets"
        [cdkDropListData]="filteredSnippets"
        [cdkDropListConnectedTo]="['page-snippets']"
        (cdkDropListDropped)="drop($event)"
        class="snippet-list"
      >
        <div
          *ngFor="let snippet of filteredSnippets; trackBy: trackBySnippetId"
          cdkDrag
          [cdkDragStartDelay]="0"
          [cdkDragBoundary]="'.page-edit-container'"
          class="snippet-item"
        >
          <div class="snippet-content">
            <img
              [src]="viewUrl + '/public/images/screenshots/' + snippet.id + '.png'"
              alt="Snippet screenshot"
              class="snippet-screenshot"
            />
            <span class="drag-handle">⋮⋮</span>
          </div>
        </div>
        <div *ngIf="filteredSnippets.length === 0" class="empty-state">No matching snippets</div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button (click)="router.navigate(['/pages'])">Back to Pages</button>
  </div>
</div>

<div *ngIf="!page && pageId">
  <p>Loading page...</p>
</div>

<div *ngIf="!pageId">
  <p>No page ID provided</p>
  <button (click)="router.navigate(['/pages'])">Back to Pages</button>
</div>
